input {
  # NGINX Logs
  file {
    path => "/var/log/nginx/*.log"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    type => "nginx"
  }

  # MariaDB Logs
  file {
    path => "/var/log/mysql/*.log"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    type => "mariadb"
  }
}

filter {
  # NGINX Log Filter
  if [type] == "nginx" {
    grok {
      match => { "message" => "%{COMBINEDAPACHELOG}" }
    }
    date {
      match => [ "timestamp" , "dd/MMM/yyyy:HH:mm:ss Z" ]
      target => "@timestamp"
    }
  }

  # MariaDB Log Filter
  if [type] == "mariadb" {
    grok {
      match => { "message" => "%{GREEDYDATA:query}" }
    }
    mutate {
      add_field => { "source_type" => "mariadb" }
    }
  }
}

output {
  # NGINX Logs Output
  if [type] == "nginx" {
    elasticsearch {
      hosts => "http://elasticsearch:9200"
      index => "nginx-logs-%{+YYYY.MM.DD}"
    }
  }

  # MariaDB Logs Output
  if [type] == "mariadb" {
    elasticsearch {
      hosts => "http://elasticsearch:9200"
      index => "mariadb-logs-%{+YYYY.MM.DD}"
    }
  }

  # Optional Elasticsearch Output (commented out as credentials are placeholder)
  # if [type] == "elasticsearch" {
  #   elasticsearch {
  #     hosts => "http://elasticsearch:9200"
  #     index => "filebeat-test%{+YYYY.MM.DD}"
  #     user => "elastic"
  #     password => "your_actual_password"
  #   }
  # }

  # Debug Output
  stdout {
    codec => rubydebug
  }
}